<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.baby.babycareproductsshop.order.OrderMapper_">
    <select id="getOrder">
        SELECT a.iorder, (
        case a.process_state
        when 0 then '구매확인'
        when 1 then '배송준비중'
        when 2 then '배송중'
        when 3 then '배송완료'
        when 4 then '주문취소'
        when 5 then '반품' END) processState,
        b.iproduct, a.created_at createdAt, b.idetails, c.rep_pic repPic, c.product_nm productNm, b.product_cnt productCnt,
        (SELECT price FROM t_product WHERE iproduct = b.iproduct) * b.product_cnt price,
        b.refund_fl refundFl,
        (SELECT COUNT(*) FROM t_review WHERE ireview = b.idetails) reviewFl
        FROM t_order a
        INNER JOIN t_order_details b
        ON a.iorder = b.iorder
        INNER JOIN t_product c
        ON b.iproduct = c.iproduct
        WHERE a.iorder = #{iorder}
    </select>
</mapper>